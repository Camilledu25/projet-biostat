---
title: "biostat"
author: "camille mathilde"
date: "22/12/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(dplyr)
library(tidyr)
library(kableExtra)
library(pander)
library(corrplot)
library(ggplot2)
```
\newpage

# Introduction 

De nos jours, les maladies sont de plus en plus étudiées et de mieux en mieux comprises. De nombreux organismes et intituts recherchent des solutions pour vaincre ces maladies en trouvant des traitements. De nombreuses diciplines sont impliquées, notamment la biostatistique, qui permet d'étudier différentes situations avec des données. Dans notre cas, nous allons étudier l'occurence des maladies coronarienne du coeur. Une étude préalable à déja été faite sur une cohorte d'individus. Ces individus ont répondu à une date donnée à une enquête sur les habitudes alimentaires. Les réponses ont été recueilli dans une base de donnée que l'on nomme \textbf{Coeur}.

## Présentation de la base de donnée

Notre table de données contient 337 individus et 15 variables qui sont

\begin{itemize}
\item \textbf{Id} : l'identifiant du sujet. \
\item	\textbf{DateEntrée} et \textbf{Date de sortie} : les dates d’entrée et de sortie de l’étude. \
\item	\textbf{Date Naissance} : la date de naissance. \
\item	\textbf{Statut} : si la sortie de l’enquête est due à une maladie coronarienne de cœur, alors le type de maladie est indiqué (la signification du code n’est pas précisée ici). Si l’individu est sain à la sortie  de l’enquête, alors le code vaut 0.\
\item	\textbf{Emploi} : le type d’emploi.\
\item	\textbf{MoisEnquête} : le mois (1= Janvier, 12= Décembre) où l’individu a répondu à l’enquête sur ses pratiques alimentaires.\
\item	\textbf{Taille/Poids} : la taille et le poids de l'individu (en cm et en kg).\
\item	\textbf{Graisse} : la quantité moyenne de graisse ingérée par jour (g/jour).\
\item	\textbf{Fibres} : la quantité moyenne de fibres ingérée par jour (g/jour).\
\item	\textbf{Consommation} : la quantité de calories(/100) ingérée par jour.\
\item	\textbf{hauteConsomation} : une variable binaire, recodage de la variable consommation.\
\item	\textbf{MCC} : une variable binaire, recodage de la variable statut (1=MCC, 0=pas de MCC). \
\end{itemize}

Nous avons également rajouté la variable $\textbf{IMC}$ en divisant le poids par la taille au carrée pour faire un lien entre la condition physique et la maladie du coeur car le poids ou la taille tout seul ne suffisent pas pour savoir si une personne est en bonne santé ou en surpoids. \

Nous nous sommes également rendu compte qu'il y avait des erreurs dans le recodage de la variables \textbf{statut}. En effet, certains individus avaient contracté une maladie du coeur, mais la variable recodage \textbf{MCC} ne l'avait pas pris en compte nous avons  donc rectifié ça. Nous avons aussi remarqué que certaines variables qualitatives étaient en \textbf{numeric}, ce qui posera problème pour notre étude. Nous les recodons donc en \textbf{factor}.\
Nous observons enfin que la table de données contient des valeurs manquantes. Nous enlevons donc chaque ligne qui contient au moins une valeur manquante. Nous passons donc de 337 à 328 individus. \

Regardons les 5 premières lignes de notre table de données : \

```{r}
coeur <- readRDS('data/my_data_frame.rds')
coeur <-coeur%>%drop_na()
coeur <-coeur%>%dplyr::select(-X1)
coeur$statut<-as.factor(coeur$statut)
coeur$emploi<-as.factor(coeur$emploi)
coeur$moisEnqu_e<-as.factor(coeur$moisEnqu_e)
coeur$hauteConsomation<-as.factor(coeur$hauteConsomation)

coeur<-mutate(coeur,imc =poids /(taille/100)^2)
coeur<-coeur %>% dplyr::select(-MCC)
coeur <-mutate(coeur,MCC =case_when(
  statut!=0~1,
  TRUE~0))

pander(head(coeur))
```
\

Remarquons que cet ensemble d'individu est bien une cohorte car nous avons relevé certaines covariables et les trois données fondamentales qui sont, la date d'entrée dans l'étude, la date de sortie dans l'étude et le cause de sortie dans l'étude. Nous pouvons ajouter que les covariables utilisées dans l'étude sont fixe.


\newpage

# Statistique descriptive 

Notre jeu de donnée présente 5 variables quantitatives et 9 variables qualitatives.

Faisons un sommaire des variables quantitatives : 
```{r,echo=FALSE,fig.width=6, fig.height=4,fig.align='center'}
df_quanti<-coeur%>%select(consommation,fibre,graisse,taille,poids)%>%summary()
pander(df_quanti)
```

Les individus mangent en moyenne 2835 calories par jours. Ils ingèrent de plus 12.76 grammes de gras par jour, mesurent 173 cm et pèsent 72.40 kilo-gramme en moyenne. \

Faisons maintenant un sommaire des variables quantitatives : 

```{r,echo=FALSE,fig.width=6, fig.height=4,fig.align='center'}
df_quali<-coeur%>%select(statut,emploi,moisEnqu_e,hauteConsomation)%>%summary()
pander(df_quali)
```

Il y a 2 fois plus de $\textbf{Bank worker}$ que de $\textbf{Conductor}$ ou de $\textbf{Driver}$. Il y a $149$ personnes qui mangent moins de $2750$ calories par jours et $179$ personnes qui en mangent plus. \

Regardons désormais la corrélation entre les variables quantitatives : \

```{r,fig.width=4.1, fig.height=2.7,fig.align='center',echo=FALSE}
df_quanti1<-coeur%>%select(consommation,fibre,graisse,taille,poids)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(cor(df_quanti1), method="color", col=col(200), type="upper", order="hclust",
addCoef.col = "black", tl.col="black", tl.srt=45, diag=FALSE)

```

Nous observons que toutes les variables sont corrélées positivement. \ 


La variable \textbf{consommation} est très corrélée avec la variable \textbf{graisse} mais elle est très peu corrélée avec la variable \textbf{taille}. La variable \textbf{taille} est peu corrélée avec la variable \textbf{graisse}. \

Nous allons maintenant regarder le lien entre la maladie et le secteur d'activité. \

```{r,fig.width=5, fig.height=3.5,fig.align='center',echo=FALSE}
barplot(prop.table(table(coeur$emploi,coeur$MCC),margin=2),
beside=TRUE, ylim=c (0 ,1),legend.text = T,
main="Malade en fonction du secteur d'activité ",xlab ="MCC",ylab="Fréquence")
```

Nous observons que la proportion de conducteur est plus élevée chez les malades que chez les non malades.

Nous allons maintenant regarder le lien entre l'IMC et les maladies coronariennes.

```{r, fig.width=4.5, fig.height=3.5,fig.align='center',echo=FALSE}
coeur$MCC<-as.factor(coeur$MCC)
p<-ggplot(coeur, aes(x=MCC, y=imc, color=MCC)) +
  geom_boxplot()
p
```

Nous remarquons que la mediane de l'IMC du groupe de personnes malades est à peine plus basse que la médiane pour le groupe de personnes non malade. Une simple analyse descriptive ne suffit pas pour obtenir des résultats bien concluants, nous allons continuer avec des méthodes plus poussées. Nous commencerons par des régréssions logistiques.

# regression logistique binaire

Nous allons commencer par une régréssion logistique qui nous permettera d'expliquer la variable $\textbf{MCC}$ en fonction de toutes les autres covariables. Rappelons que dans la régréssion logistique ce n'est pas la réponse binaire qui est modélisé mais la probabilité de réalisation d'une des deux modalités (avoir une maladie coronarienne ou non). \

Nous allons commencer par regarder le meilleur modèle en comparant les AIC puis nous étudierons ce modèle. \

```{r,}
library(MASS)
coeurlogbin<-coeur%>%dplyr::select(-id,-dateEntree,-dateSortie,-dateNaissance,-statut,-hauteConsomation)
res<-glm(MCC~.,family = binomial(logit),data=coeurlogbin)
stepAIC(res)
```

```{r,}
reslog<-glm(MCC~imc,family = binomial(logit),data=coeurlogbin)
reslog
confint(reslog)
```
Les modalités de références sont :  

\begin{itemize}
\item Pour la variable \textbf{emploi} : Bank worker \
\item Pour la variable \textbf{moisEnquete} : 1 (Janvier) \
\end{itemize}


# régréssion polytomique ordonné

```{r,}
coeur <-mutate(coeur,consom_dec =case_when(
  consommation<23~"peu",
  consommation>22 & consommation<30~"moyen",
  consommation>29 ~"beaucoup"))
coeur$consom_dec<-as.factor(coeur$consom_dec)
```

```{r,}
coeurlogbin1<-coeur%>%dplyr::select(-id,-dateEntree,-dateSortie,-dateNaissance,-statut,-hauteConsomation,-consommation)
modele<-polr(consom_dec~.,data=coeurlogbin1)
stepAIC(modele)
```








```{r,}
modele2<-polr(consom_dec~graisse+fibre,data=coeurlogbin1)
modele2
confint(modele2)
```

La commande polyr utilisée renvoie l'opposé du coefficient $\beta$ considéré donc nous obtenons les résultats suivants pour nos coefficients: \

QUESTION SUR LES MOINS

$$ln \bigg(\frac{odds(Y \leq moyen | graisse = x_1+1, fibre=x_2)}{odds(Y \leq moyen | graisse = x_1, fibre=x_2)}\bigg)=\beta_{graisse}=1.29$$

A consommation de fibre fixée, augmenter la consommation de graisse de 1 g/jour va diviser $odds(Y \leq moyen)$ par au moins $exp(-1.56)$. \ QUEST

$$ln \bigg(\frac{odds(Y \leq moyen | fibre = x_1+1, graisse=x_2)}{odds(Y \leq moyen | fibre = x_1, graisse=x_2)}\bigg)=\beta_{fibre}=1.81$$

A consommation de graisse fixée, augmenter la consommation de fibre de 1 g/jour va diviser $odds(Y \leq moyen)$ par au moins $exp(-2.599)$. \ QUEST

# régréssion polytomique non-ordonné


```{r,}
library(nnet)
modele3<-multinom(emploi~.,data=coeurlogbin1)
stepAIC(modele3)
```

```{r,}
modele4<-multinom(emploi~poids+taille,data=coeurlogbin1)
modele4
confint(modele4)
```

Bank worker est la modalité de référence pour emploi. \

$$\beta_{poids|conductor}=ln \bigg(\frac{\frac{P(conductor| poids = x_1+1, taille=x_2)}{P(Bank worker | poids = x_1+1, taille=x_2)}}{\frac{P(conductor | poids = x_1, taille=x_2)}{P(Bank worker | poids = x_1,taille=x_2)}}\bigg)=-0.07620753 $$  

QUESTION POUR LES MO DE REF X1 X2

Toutes les autres covariables fixées à leurs modalités de référencee, un 1kg en plus va multiplier par au moins $exp(-0.1114239)=$ la préférnec de conductor par rapport à Bank worker. \



$$\beta_{taille|conductor}=ln \bigg(\frac{\frac{P(conductor| taille = x_1+1, poids=x_2)}{P(Bank worker | taille = x_1+1, poids=x_2)}}{\frac{P(conductor | taille = x_1, poids=x_2)}{P(Bank worker | taille = x_1,poids=x_2)}}\bigg)=-0.1694273$$  

QUESTION POUR LES MO DE REF X1 X2

Toutes les autres covariables fixées à leurs modalités de référencee, un 1cm en plus va multiplier par au moins $exp( -0.1959546)=$ la préférence de conductor par rapport à Bank worker. \


# Modèle de Cox


Recodage au format date. \

```{r,}
library(lubridate)
coeur$dateEntree<-as.Date(coeur$dateEntree,format="%d/%m/%y")
year(coeur$dateEntree)<-1900+year(coeur$dateEntree) %% 100
coeur$dateSortie<-as.Date(coeur$dateSortie,format="%d/%m/%y")
year(coeur$dateSortie)<-1900+year(coeur$dateSortie) %% 100

coeur<-coeur%>% mutate(time = coeur$dateSortie - coeur$dateEntree )
```

```{r,}
coeurcox<-coeur%>%dplyr::select(-id,-dateEntree,-dateSortie,-dateNaissance,-statut,-hauteConsomation)
 library(survival)
  survie=Surv(coeur$time,coeur$MCC)
#   res=coxph(survie~.-moisEnqu_e,data=coeurcox)
# res


```


#  DIAPO TRUC EN PLUS 


